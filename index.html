<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Clicker Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6a5acd;
            --secondary: #483d8b;
            --accent: #9370db;
            --background: #f8f9fa;
            --card: #ffffff;
            --text: #2c3e50;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            background-image: radial-gradient(circle at 50% 50%, #f0f2f5 0%, #e5e8eb 100%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 0;
            border-radius: 10px 10px 0 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: rotate(30deg);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .logo i {
            margin-right: 10px;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0,0,0,0.1);
            padding: 8px 15px;
            border-radius: 50px;
            backdrop-filter: blur(5px);
        }

        .avatar {
            width: 40px;
            height: 40px;
            background-color: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .avatar:hover {
            transform: scale(1.1);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .clicker-section {
            background-color: var(--card);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .clicker-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .clicker-title {
            font-size: 22px;
            margin-bottom: 25px;
            color: var(--primary);
            position: relative;
            display: inline-block;
        }

        .clicker-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: var(--accent);
            border-radius: 3px;
        }

        .click-button {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            border-radius: 50%;
            width: 160px;
            height: 160px;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.3s;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(106, 90, 205, 0.4);
            position: relative;
            overflow: hidden;
        }

        .click-button:hover {
            box-shadow: 0 10px 25px rgba(106, 90, 205, 0.6);
        }

        .click-button:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(106, 90, 205, 0.3);
        }

        .click-button i {
            font-size: 60px;
            transition: transform 0.2s;
        }

        .click-button:active i {
            transform: scale(0.9);
        }

        .click-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            transform: scale(0);
            opacity: 0;
            transition: transform 0.5s, opacity 0.5s;
        }

        .click-button:active::after {
            transform: scale(1);
            opacity: 1;
            transition: transform 0s, opacity 0s;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 25px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat {
            text-align: center;
            background: rgba(106, 90, 205, 0.1);
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            min-width: 120px;
            transition: transform 0.3s;
        }

        .stat:hover {
            transform: translateY(-5px);
            background: rgba(106, 90, 205, 0.15);
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .card-title i {
            color: var(--accent);
        }

        .upgrade {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transition: background-color 0.3s;
            border-radius: 5px;
            padding: 12px;
        }

        .upgrade:hover {
            background-color: rgba(106, 90, 205, 0.05);
        }

        .upgrade:last-child {
            border-bottom: none;
        }

        .upgrade-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .upgrade-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .upgrade-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .upgrade-description {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .upgrade-cost {
            font-weight: bold;
            color: var(--success);
            text-align: right;
            margin-bottom: 5px;
        }

        .upgrade-button {
            background: linear-gradient(135deg, var(--success), #1e7e34);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 6px 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .upgrade-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .upgrade-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }

        .upgrade-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .achievement {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transition: background-color 0.3s;
            border-radius: 5px;
        }

        .achievement:hover {
            background-color: rgba(106, 90, 205, 0.05);
        }

        .achievement:last-child {
            border-bottom: none;
        }

        .achievement-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--warning), #e0a800);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .achievement-locked {
            background: linear-gradient(135deg, #cccccc, #999999);
        }

        .achievement-info {
            flex-grow: 1;
        }

        .achievement-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .achievement-description {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .achievement-reward {
            font-size: 12px;
            color: var(--success);
            font-weight: bold;
            white-space: nowrap;
        }

        .clan-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .clan {
            display: flex;
            align-items: center;
            padding: 12px;
            background-color: #f9f9f9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .clan:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            background-color: white;
        }

        .clan-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .clan-info {
            flex-grow: 1;
        }

        .clan-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .clan-members {
            font-size: 12px;
            color: #666;
        }

        .join-button {
            background: linear-gradient(135deg, var(--success), #1e7e34);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 6px 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .join-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .join-button.joined {
            background: linear-gradient(135deg, var(--danger), #c82333);
        }

        .join-button.joined:hover {
            background: linear-gradient(135deg, #dc3545, #bd2130);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            transform: translateY(-20px);
            opacity: 0;
            animation: modalOpen 0.3s forwards;
        }

        @keyframes modalOpen {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.2);
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
        }

        .modal-button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 13px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .modal-button.primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }

        .modal-button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(106, 90, 205, 0.3);
        }

        .modal-button.secondary {
            background: #f1f1f1;
            color: #333;
        }

        .modal-button.secondary:hover {
            background: #e0e0e0;
        }

        .title-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--warning), #e0a800);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 8px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .rank-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 8px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .leaderboard {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .leaderboard th, .leaderboard td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .leaderboard th {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.5px;
        }

        .leaderboard tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .leaderboard tr:hover {
            background-color: #f1f1f1;
        }

        .leaderboard-position {
            width: 40px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
        }

        .leaderboard-avatar {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }

        .progress-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .progress-info div {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .progress-info div:last-child {
            border-bottom: none;
        }

        .tab-container {
            margin-top: 25px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            color: #666;
            position: relative;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success), #1e7e34);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-content {
            display: flex;
            flex-direction: column;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 14px;
        }

        .prestige-button {
            background: linear-gradient(135deg, var(--warning), #e0a800);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(255, 193, 7, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .prestige-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(255, 193, 7, 0.4);
        }

        .prestige-button:active {
            transform: translateY(0);
        }

        .prestige-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 8px;
            text-align: center;
        }

        .prestige-level {
            font-weight: bold;
            color: var(--warning);
            font-size: 18px;
        }

        .prestige-bonus {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .user-info {
                width: 100%;
                justify-content: center;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .stat {
                min-width: auto;
            }
        }

        /* Анимации */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .float {
            animation: float 3s ease-in-out infinite;
        }

        /* Эффект частиц */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            background-color: var(--accent);
            border-radius: 50%;
            opacity: 0.6;
        }

        /* Конфетти эффект */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            z-index: 9999;
            animation: confettiFall 5s linear forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-mouse-pointer"></i>
                    Epic Clicker
                </div>
                <div class="user-info">
                    <div class="avatar" id="user-avatar">U</div>
                    <div>
                        <div id="username-display">Гость</div>
                        <div>
                            <span id="rank-display" class="rank-badge">Новичок</span>
                            <span id="title-display" class="title-badge">Неизвестный</span>
                        </div>
                    </div>
                    <button id="edit-profile-btn" style="background: none; border: none; color: white; cursor: pointer;">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="clicker-section">
                <h2 class="clicker-title">Кликай, чтобы зарабатывать очки!</h2>
                <button class="click-button" id="click-button">
                    <i class="fas fa-hand-pointer"></i>
                </button>
                
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="points-counter">0</div>
                        <div class="stat-label">Очков</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="points-per-second">0</div>
                        <div class="stat-label">В секунду</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="points-per-click">1</div>
                        <div class="stat-label">За клик</div>
                    </div>
                </div>

                <div class="tab-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="upgrades">Улучшения</div>
                        <div class="tab" data-tab="achievements">Достижения</div>
                        <div class="tab" data-tab="leaderboard">Лидеры</div>
                        <div class="tab" data-tab="prestige">Престиж</div>
                    </div>
                    
                    <div class="tab-content active" id="upgrades-tab">
                        <div class="upgrades-list" id="upgrades-list">
                            <!-- Улучшения будут добавлены через JS -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="achievements-tab">
                        <div class="achievements-list" id="achievements-list">
                            <!-- Достижения будут добавлены через JS -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="leaderboard-tab">
                        <table class="leaderboard">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Игрок</th>
                                    <th>Очки</th>
                                    <th>Звание</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body">
                                <!-- Таблица лидеров будет заполнена через JS -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="prestige-tab">
                        <div class="prestige-info">
                            <div class="prestige-level">Уровень престижа: <span id="prestige-level">0</span></div>
                            <div class="prestige-bonus">Текущий бонус: <span id="prestige-bonus">+0%</span> к доходу</div>
                        </div>
                        <button class="prestige-button" id="prestige-button" disabled>
                            <i class="fas fa-star"></i> Престиж
                        </button>
                        <div id="prestige-requirements" style="margin-top: 15px; color: #666; font-size: 14px; text-align: center;">
                            Для престижа нужно 25,000 очков
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-users"></i> Кланы</h3>
                    <div class="clan-list" id="clan-list">
                        <!-- Список кланов будет добавлен через JS -->
                    </div>
                    <button id="create-clan-btn" style="width: 100%; margin-top: 10px; background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                        <i class="fas fa-plus"></i> Создать клан
                    </button>
                </div>

                <div class="card">
                    <h3 class="card-title"><i class="fas fa-trophy"></i> Прогресс</h3>
                    <div class="progress-info">
                        <div>Всего кликов: <span id="total-clicks">0</span></div>
                        <div>Время игры: <span id="play-time">0:00</span></div>
                        <div>Улучшений: <span id="upgrades-bought">0</span></div>
                        <div>Достижений: <span id="achievements-unlocked">0</span>/<span id="achievements-total">0</span></div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-chart-line"></i> Статистика</h3>
                    <div class="progress-info">
                        <div>Кликов в сек: <span id="clicks-per-second">0</span></div>
                        <div>Очков в сек: <span id="points-per-second-stat">0</span></div>
                        <div>Эффективность: <span id="click-efficiency">0%</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно редактирования профиля -->
    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-user-edit"></i> Редактирование профиля</h3>
            <div class="form-group">
                <label for="username-input">Имя игрока</label>
                <input type="text" id="username-input" placeholder="Введите ваше имя" maxlength="15">
            </div>
            <div class="form-group">
                <label for="title-select">Титул</label>
                <select id="title-select">
                    <!-- Титулы будут добавлены через JS -->
                </select>
            </div>
            <div class="form-group">
                <label for="avatar-color">Цвет аватара</label>
                <input type="color" id="avatar-color" value="#4fc3f7">
            </div>
            <div class="modal-buttons">
                <button class="modal-button secondary" id="cancel-profile-btn">Отмена</button>
                <button class="modal-button primary" id="save-profile-btn">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно создания клана -->
    <div class="modal" id="clan-modal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-users"></i> Создать клан</h3>
            <div class="form-group">
                <label for="clan-name-input">Название клана</label>
                <input type="text" id="clan-name-input" placeholder="Введите название клана" maxlength="20">
            </div>
            <div class="form-group">
                <label for="clan-tag-input">Тег клана (2-4 символа)</label>
                <input type="text" id="clan-tag-input" placeholder="Например: EPIC" maxlength="4">
            </div>
            <div class="modal-buttons">
                <button class="modal-button secondary" id="cancel-clan-btn">Отмена</button>
                <button class="modal-button primary" id="create-clan-confirm-btn">Создать</button>
            </div>
        </div>
    </div>

    <!-- Уведомления -->
    <div id="notification" class="notification">
        <div class="notification-icon">
            <i class="fas fa-trophy"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">Достижение разблокировано!</div>
            <div class="notification-message"></div>
        </div>
    </div>

    <script>
        // Игровые данные
        const gameState = {
            points: 0,
            pointsPerClick: 1,
            pointsPerSecond: 0,
            totalClicks: 0,
            playTime: 0,
            upgradesBought: 0,
            username: 'Гость',
            avatarColor: '#6a5acd',
            title: 'Неизвестный',
            rank: 'Новичок',
            clan: null,
            lastUpdate: Date.now(),
            lastClickTime: 0,
            clicksInSecond: 0,
            prestigeLevel: 0,
            prestigeBonus: 1,
            sessionStart: Date.now(),
            achievementsUnlocked: 0
        };

        // Улучшения
        const upgrades = [
            {
                id: 'click-power-1',
                name: 'Улучшенный курсор',
                description: 'Увеличивает силу клика на 1',
                icon: 'fa-mouse',
                baseCost: 10,
                costIncrease: 1.5,
                owned: 0,
                max: 20,
                effect: () => { gameState.pointsPerClick += 1 * gameState.prestigeBonus; }
            },
            {
                id: 'auto-click-1',
                name: 'Автокликер',
                description: 'Автоматически кликает 1 раз в секунду',
                icon: 'fa-robot',
                baseCost: 50,
                costIncrease: 1.8,
                owned: 0,
                max: 10,
                effect: () => { gameState.pointsPerSecond += 1 * gameState.prestigeBonus; }
            },
            {
                id: 'click-power-2',
                name: 'Профессиональный кликер',
                description: 'Увеличивает силу клика на 5',
                icon: 'fa-mouse-pointer',
                baseCost: 200,
                costIncrease: 1.7,
                owned: 0,
                max: 10,
                effect: () => { gameState.pointsPerClick += 5 * gameState.prestigeBonus; },
                requirement: () => gameState.upgradesBought >= 5
            },
            {
                id: 'auto-click-2',
                name: 'Продвинутый автокликер',
                description: 'Автоматически кликает 5 раз в секунду',
                icon: 'fa-cogs',
                baseCost: 1000,
                costIncrease: 1.9,
                owned: 0,
                max: 5,
                effect: () => { gameState.pointsPerSecond += 5 * gameState.prestigeBonus; },
                requirement: () => gameState.upgradesBought >= 10
            },
            {
                id: 'click-power-3',
                name: 'Мастер кликов',
                description: 'Увеличивает силу клика на 10',
                icon: 'fa-hand-pointer',
                baseCost: 5000,
                costIncrease: 2,
                owned: 0,
                max: 5,
                effect: () => { gameState.pointsPerClick += 10 * gameState.prestigeBonus; },
                requirement: () => gameState.upgradesBought >= 20
            },
            {
                id: 'auto-click-3',
                name: 'Квантовый кликер',
                description: 'Автоматически кликает 20 раз в секунду',
                icon: 'fa-atom',
                baseCost: 20000,
                costIncrease: 2.2,
                owned: 0,
                max: 3,
                effect: () => { gameState.pointsPerSecond += 20 * gameState.prestigeBonus; },
                requirement: () => gameState.upgradesBought >= 30
            }
        ];

        // Достижения
        const achievements = [
            {
                id: 'first-click',
                name: 'Первый клик',
                description: 'Совершите ваш первый клик',
                icon: 'fa-hand-pointer',
                reward: 10,
                achieved: false,
                check: () => gameState.totalClicks >= 1
            },
            {
                id: '100-clicks',
                name: '100 кликов',
                description: 'Совершите 100 кликов',
                icon: 'fa-mouse',
                reward: 50,
                achieved: false,
                check: () => gameState.totalClicks >= 100
            },
            {
                id: '1000-clicks',
                name: '1000 кликов',
                description: 'Совершите 1000 кликов',
                icon: 'fa-mouse-pointer',
                reward: 200,
                achieved: false,
                check: () => gameState.totalClicks >= 1000
            },
            {
                id: '10000-clicks',
                name: '10 000 кликов',
                description: 'Совершите 10 000 кликов',
                icon: 'fa-hand-paper',
                reward: 1000,
                achieved: false,
                check: () => gameState.totalClicks >= 10000
            },
            {
                id: 'first-upgrade',
                name: 'Первое улучшение',
                description: 'Купите первое улучшение',
                icon: 'fa-arrow-up',
                reward: 20,
                achieved: false,
                check: () => gameState.upgradesBought >= 1
            },
            {
                id: '10-upgrades',
                name: '10 улучшений',
                description: 'Купите 10 улучшений',
                icon: 'fa-layer-group',
                reward: 100,
                achieved: false,
                check: () => gameState.upgradesBought >= 10
            },
            {
                id: 'all-upgrades',
                name: 'Максимальный уровень',
                description: 'Купите все улучшения',
                icon: 'fa-trophy',
                reward: 1000,
                achieved: false,
                check: () => upgrades.every(u => u.owned >= u.max)
            },
            {
                id: '100-points',
                name: '100 очков',
                description: 'Заработайте 100 очков',
                icon: 'fa-coins',
                reward: 10,
                achieved: false,
                check: () => gameState.points >= 100
            },
            {
                id: '1000-points',
                name: '1000 очков',
                description: 'Заработайте 1000 очков',
                icon: 'fa-money-bill-wave',
                reward: 50,
                achieved: false,
                check: () => gameState.points >= 1000
            },
            {
                id: '10000-points',
                name: '10 000 очков',
                description: 'Заработайте 10 000 очков',
                icon: 'fa-gem',
                reward: 200,
                achieved: false,
                check: () => gameState.points >= 10000
            },
            {
                id: '25000-points',
                name: '25 000 очков',
                description: 'Заработайте 25 000 очков',
                icon: 'fa-crown',
                reward: 500,
                achieved: false,
                check: () => gameState.points >= 25000
            },
            {
                id: 'join-clan',
                name: 'В команде',
                description: 'Вступите в клан',
                icon: 'fa-users',
                reward: 100,
                achieved: false,
                check: () => gameState.clan !== null
            },
            {
                id: 'create-clan',
                name: 'Основатель',
                description: 'Создайте свой клан',
                icon: 'fa-crown',
                reward: 200,
                achieved: false,
                check: () => clans.some(clan => clan.leader === gameState.username)
            },
            {
                id: 'prestige-1',
                name: 'Первый престиж',
                description: 'Выполните первый престиж',
                icon: 'fa-star',
                reward: 1000,
                achieved: false,
                check: () => gameState.prestigeLevel >= 1
            }
        ];

        // Титулы
        const titles = [
            { id: 'unknown', name: 'Неизвестный', requirement: () => true },
            { id: 'beginner', name: 'Новичок', requirement: () => gameState.points >= 100 },
            { id: 'clicker', name: 'Кликер', requirement: () => gameState.totalClicks >= 100 },
            { id: 'pro', name: 'Профессионал', requirement: () => gameState.points >= 1000 },
            { id: 'expert', name: 'Эксперт', requirement: () => gameState.points >= 5000 },
            { id: 'master', name: 'Мастер', requirement: () => gameState.points >= 10000 && gameState.totalClicks >= 1000 },
            { id: 'legend', name: 'Легенда', requirement: () => gameState.points >= 50000 && gameState.totalClicks >= 5000 },
            { id: 'god', name: 'Бог кликов', requirement: () => gameState.points >= 100000 && gameState.totalClicks >= 10000 }
        ];

        // Звания (ранги)
        const ranks = [
            { name: 'Новичок', minPoints: 0 },
            { name: 'Ученик', minPoints: 100 },
            { name: 'Испытатель', minPoints: 500 },
            { name: 'Странник', minPoints: 1000 },
            { name: 'Искатель', minPoints: 2500 },
            { name: 'Мастер', minPoints: 5000 },
            { name: 'Герой', minPoints: 10000 },
            { name: 'Легенда', minPoints: 25000 },
            { name: 'Миф', minPoints: 50000 },
            { name: 'Божество', minPoints: 100000 }
        ];

        // Кланы
        let clans = [
            { id: 1, name: 'Эпичные кликеры', tag: 'EPIC', members: ['Гость'], leader: 'Гость', points: 0 }
        ];

        // Игроки (для таблицы лидеров)
        let players = [
            { username: 'Гость', points: 0, rank: 'Новичок', avatarColor: '#6a5acd' }
        ];

        // DOM элементы
        const pointsCounter = document.getElementById('points-counter');
        const pointsPerSecond = document.getElementById('points-per-second');
        const pointsPerClick = document.getElementById('points-per-click');
        const clickButton = document.getElementById('click-button');
        const upgradesList = document.getElementById('upgrades-list');
        const achievementsList = document.getElementById('achievements-list');
        const leaderboardBody = document.getElementById('leaderboard-body');
        const clanList = document.getElementById('clan-list');
        const usernameDisplay = document.getElementById('username-display');
        const rankDisplay = document.getElementById('rank-display');
        const titleDisplay = document.getElementById('title-display');
        const userAvatar = document.getElementById('user-avatar');
        const totalClicks = document.getElementById('total-clicks');
        const playTime = document.getElementById('play-time');
        const upgradesBought = document.getElementById('upgrades-bought');
        const profileModal = document.getElementById('profile-modal');
        const clanModal = document.getElementById('clan-modal');
        const usernameInput = document.getElementById('username-input');
        const titleSelect = document.getElementById('title-select');
        const avatarColor = document.getElementById('avatar-color');
        const saveProfileBtn = document.getElementById('save-profile-btn');
        const cancelProfileBtn = document.getElementById('cancel-profile-btn');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const createClanBtn = document.getElementById('create-clan-btn');
        const clanNameInput = document.getElementById('clan-name-input');
        const clanTagInput = document.getElementById('clan-tag-input');
        const createClanConfirmBtn = document.getElementById('create-clan-confirm-btn');
        const cancelClanBtn = document.getElementById('cancel-clan-btn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const notification = document.getElementById('notification');
        const notificationMessage = document.querySelector('.notification-message');
        const prestigeButton = document.getElementById('prestige-button');
        const prestigeLevel = document.getElementById('prestige-level');
        const prestigeBonus = document.getElementById('prestige-bonus');
        const prestigeRequirements = document.getElementById('prestige-requirements');
        const achievementsUnlocked = document.getElementById('achievements-unlocked');
        const achievementsTotal = document.getElementById('achievements-total');
        const clicksPerSecond = document.getElementById('clicks-per-second');
        const pointsPerSecondStat = document.getElementById('points-per-second-stat');
        const clickEfficiency = document.getElementById('click-efficiency');

        // Инициализация игры
        function initGame() {
            loadGame();
            updateUI();
            renderUpgrades();
            renderAchievements();
            renderClans();
            renderLeaderboard();
            renderTitles();
            startGameLoop();
            setupEventListeners();
            
            // Обновляем общее количество достижений
            achievementsTotal.textContent = achievements.length;
            
            // Проверяем достижения при загрузке
            checkAchievements();
        }

        // Загрузка игры
        function loadGame() {
            const savedGame = localStorage.getItem('epicClickerSave');
            if (savedGame) {
                try {
                    const parsed = JSON.parse(savedGame);
                    
                    // Проверяем, не пытается ли игрок изменить сохранение
                    if (parsed._signature !== generateSignature(parsed)) {
                        throw new Error("Invalid save data");
                    }
                    
                    // Удаляем служебное поле
                    delete parsed._signature;
                    
                    // Восстанавливаем состояние игры
                    Object.assign(gameState, parsed);
                    
                    // Восстанавливаем время сессии
                    gameState.sessionStart = Date.now() - (gameState.playTime * 1000);
                    
                    // Обновляем UI после загрузки
                    updatePlayerInfo();
                    updateStats();
                    updatePrestigeInfo();
                    
                    // Обновляем таблицу лидеров для текущего игрока
                    updatePlayerInLeaderboard();
                } catch (e) {
                    console.error("Ошибка загрузки сохранения:", e);
                    resetGame();
                }
            }
        }

        // Генерация подписи для сохранения
        function generateSignature(data) {
            // Простая проверка для демонстрации
            let str = '';
            for (const key in data) {
                if (key !== '_signature') {
                    str += data[key];
                }
            }
            return str.length.toString(16);
        }

        // Сброс игры при обнаружении невалидных данных
        function resetGame() {
            localStorage.removeItem('epicClickerSave');
            window.location.reload();
        }

        // Сохранение игры
        function saveGame() {
            // Добавляем подпись для проверки целостности
            gameState._signature = generateSignature(gameState);
            localStorage.setItem('epicClickerSave', JSON.stringify(gameState));
        }

        // Игровой цикл
        function startGameLoop() {
            // Основной цикл (1 раз в секунду)
            setInterval(() => {
                const now = Date.now();
                const deltaTime = (now - gameState.lastUpdate) / 1000;
                gameState.lastUpdate = now;
                
                // Добавляем очки за автокликеры
                if (gameState.pointsPerSecond > 0) {
                    gameState.points += gameState.pointsPerSecond * deltaTime;
                    updatePoints();
                }
                
                // Обновляем время игры
                gameState.playTime = (now - gameState.sessionStart) / 1000;
                updateStats();
                
                // Проверяем достижения
                checkAchievements();
                
                // Обновляем ранг
                updateRank();
                
                // Обновляем статистику кликов в секунду
                updateClickStats();
                
                // Обновляем доступность престижа
                updatePrestigeButton();
                
                // Сохраняем игру каждые 5 секунд
                if (Math.floor(gameState.playTime) % 5 === 0) {
                    saveGame();
                }
            }, 1000);
            
            // Вторичный цикл для более плавного обновления UI (10 раз в секунду)
            setInterval(() => {
                updateUpgrades();
            }, 100);
        }

        // Обновление UI
        function updateUI() {
            updatePoints();
            updateStats();
            updatePlayerInfo();
            updateUpgrades();
            updatePrestigeInfo();
        }

        // Обновление очков
        function updatePoints() {
            pointsCounter.textContent = Math.floor(gameState.points).toLocaleString();
            pointsPerSecond.textContent = (gameState.pointsPerSecond * gameState.prestigeBonus).toFixed(1);
            pointsPerClick.textContent = (gameState.pointsPerClick * gameState.prestigeBonus).toFixed(1);
            pointsPerSecondStat.textContent = (gameState.pointsPerSecond * gameState.prestigeBonus).toFixed(1);
        }

        // Обновление статистики
        function updateStats() {
            totalClicks.textContent = gameState.totalClicks.toLocaleString();
            
            const minutes = Math.floor(gameState.playTime / 60);
            const seconds = Math.floor(gameState.playTime % 60);
            playTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            upgradesBought.textContent = gameState.upgradesBought;
            achievementsUnlocked.textContent = gameState.achievementsUnlocked;
            
            // Обновляем эффективность кликов
            if (gameState.totalClicks > 0) {
                const efficiency = (gameState.points / gameState.totalClicks).toFixed(2);
                clickEfficiency.textContent = `${efficiency}%`;
            }
        }

        // Обновление статистики кликов
        function updateClickStats() {
            const now = Date.now();
            if (now - gameState.lastClickTime > 1000) {
                gameState.clicksInSecond = 0;
            }
            clicksPerSecond.textContent = gameState.clicksInSecond;
        }

        // Обновление информации об игроке
        function updatePlayerInfo() {
            usernameDisplay.textContent = gameState.username;
            rankDisplay.textContent = gameState.rank;
            titleDisplay.textContent = gameState.title;
            userAvatar.style.backgroundColor = gameState.avatarColor;
            userAvatar.textContent = gameState.username.charAt(0).toUpperCase();
        }

        // Обновление ранга
        function updateRank() {
            for (let i = ranks.length - 1; i >= 0; i--) {
                if (gameState.points >= ranks[i].minPoints) {
                    if (gameState.rank !== ranks[i].name) {
                        gameState.rank = ranks[i].name;
                        rankDisplay.textContent = gameState.rank;
                        updatePlayerInLeaderboard();
                    }
                    break;
                }
            }
        }

        // Обновление игрока в таблице лидеров
        function updatePlayerInLeaderboard() {
            const playerIndex = players.findIndex(p => p.username === gameState.username);
            if (playerIndex !== -1) {
                players[playerIndex].points = Math.floor(gameState.points);
                players[playerIndex].rank = gameState.rank;
                players[playerIndex].avatarColor = gameState.avatarColor;
                renderLeaderboard();
            }
        }

        // Рендер улучшений
        function renderUpgrades() {
            upgradesList.innerHTML = '';
            
            upgrades.forEach(upgrade => {
                const canSee = !upgrade.requirement || upgrade.requirement();
                if (!canSee) return;
                
                const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costIncrease, upgrade.owned));
                const canAfford = gameState.points >= cost;
                const isMaxed = upgrade.owned >= upgrade.max;
                
                const upgradeElement = document.createElement('div');
                upgradeElement.className = 'upgrade';
                upgradeElement.innerHTML = `
                    <div class="upgrade-info">
                        <div class="upgrade-icon">
                            <i class="fas ${upgrade.icon}"></i>
                        </div>
                        <div>
                            <div class="upgrade-name">${upgrade.name} (${upgrade.owned}/${upgrade.max})</div>
                            <div class="upgrade-description">${upgrade.description}</div>
                        </div>
                    </div>
                    <div>
                        <div class="upgrade-cost">${cost.toLocaleString()} очков</div>
                        <button class="upgrade-button" data-id="${upgrade.id}" ${!canAfford || isMaxed ? 'disabled' : ''}>
                            ${isMaxed ? 'MAX' : 'Купить'}
                        </button>
                    </div>
                `;
                
                upgradesList.appendChild(upgradeElement);
            });
            
            // Добавляем обработчики событий для кнопок улучшений
            document.querySelectorAll('.upgrade-button').forEach(button => {
                button.addEventListener('click', function() {
                    const upgradeId = this.getAttribute('data-id');
                    buyUpgrade(upgradeId);
                });
            });
        }

        // Покупка улучшения
        function buyUpgrade(upgradeId) {
            const upgrade = upgrades.find(u => u.id === upgradeId);
            if (!upgrade) return;
            
            const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costIncrease, upgrade.owned));
            
            if (gameState.points >= cost && upgrade.owned < upgrade.max) {
                gameState.points -= cost;
                upgrade.owned++;
                gameState.upgradesBought++;
                
                // Применяем эффект улучшения
                upgrade.effect();
                
                // Обновляем UI
                updatePoints();
                renderUpgrades();
                checkAchievements();
                
                // Сохраняем игру
                saveGame();
                
                // Эффект покупки
                createParticles(clickButton, 10, upgrade.icon);
            }
        }

        // Обновление доступности улучшений
        function updateUpgrades() {
            document.querySelectorAll('.upgrade-button').forEach(button => {
                const upgradeId = button.getAttribute('data-id');
                const upgrade = upgrades.find(u => u.id === upgradeId);
                if (!upgrade) return;
                
                const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costIncrease, upgrade.owned));
                const canAfford = gameState.points >= cost;
                const isMaxed = upgrade.owned >= upgrade.max;
                
                button.disabled = !canAfford || isMaxed;
                button.textContent = isMaxed ? 'MAX' : 'Купить';
                
                const costElement = button.parentElement.querySelector('.upgrade-cost');
                if (costElement) {
                    costElement.textContent = `${cost.toLocaleString()} очков`;
                }
            });
        }

        // Рендер достижений
        function renderAchievements() {
            achievementsList.innerHTML = '';
            
            achievements.forEach(achievement => {
                const achieved = achievement.achieved || achievement.check();
                if (achieved && !achievement.achieved) {
                    achievement.achieved = true;
                    gameState.points += achievement.reward;
                    gameState.achievementsUnlocked++;
                    updatePoints();
                }
                
                const achievementElement = document.createElement('div');
                achievementElement.className = 'achievement';
                achievementElement.innerHTML = `
                    <div class="achievement-icon ${achieved ? '' : 'achievement-locked'}">
                        <i class="fas ${achieved ? achievement.icon : 'fa-lock'}"></i>
                    </div>
                    <div class="achievement-info">
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-description">${achievement.description}</div>
                    </div>
                    <div class="achievement-reward">+${achievement.reward.toLocaleString()} очков</div>
                `;
                
                achievementsList.appendChild(achievementElement);
            });
        }

        // Проверка достижений
        function checkAchievements() {
            let needsUpdate = false;
            
            achievements.forEach(achievement => {
                if (!achievement.achieved && achievement.check()) {
                    achievement.achieved = true;
                    gameState.points += achievement.reward;
                    gameState.achievementsUnlocked++;
                    needsUpdate = true;
                    
                    // Показываем уведомление о достижении
                    showAchievementNotification(achievement);
                }
            });
            
            if (needsUpdate) {
                updatePoints();
                renderAchievements();
                saveGame();
            }
        }

        // Показ уведомления о достижении
        function showAchievementNotification(achievement) {
            notificationMessage.textContent = `${achievement.name}: ${achievement.description}`;
            notification.classList.add('show');
            
            // Эффект конфетти
            createConfetti(20);
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Создание эффекта частиц
        function createParticles(element, count, icon) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = '20px';
                particle.style.height = '20px';
                particle.style.position = 'fixed';
                particle.style.left = `${centerX}px`;
                particle.style.top = `${centerY}px`;
                particle.style.borderRadius = '50%';
                particle.style.display = 'flex';
                particle.style.alignItems = 'center';
                particle.style.justifyContent = 'center';
                particle.style.color = 'white';
                particle.style.fontSize = '12px';
                particle.innerHTML = `<i class="fas ${icon}"></i>`;
                particle.style.zIndex = '1000';
                particle.style.pointerEvents = 'none';
                
                document.body.appendChild(particle);
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 50;
                const duration = 1 + Math.random() * 1;
                
                const animation = particle.animate([
                    { 
                        transform: 'translate(0, 0) scale(1)',
                        opacity: 1 
                    },
                    { 
                        transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`,
                        opacity: 0 
                    }
                ], {
                    duration: duration * 1000,
                    easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
                });
                
                animation.onfinish = () => {
                    particle.remove();
                };
            }
        }

        // Создание эффекта конфетти
        function createConfetti(count) {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
            
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.width = `${10 + Math.random() * 10}px`;
                confetti.style.height = `${10 + Math.random() * 10}px`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // Рендер кланов
        function renderClans() {
            clanList.innerHTML = '';
            
            clans.forEach(clan => {
                const isMember = clan.members.includes(gameState.username);
                const isLeader = clan.leader === gameState.username;
                
                const clanElement = document.createElement('div');
                clanElement.className = 'clan';
                clanElement.innerHTML = `
                    <div class="clan-avatar">${clan.tag}</div>
                    <div class="clan-info">
                        <div class="clan-name">${clan.name} [${clan.tag}]</div>
                        <div class="clan-members">${clan.members.length} участников</div>
                    </div>
                    <button class="join-button ${isMember ? 'joined' : ''}" data-id="${clan.id}">
                        ${isMember ? (isLeader ? 'Лидер' : 'Выйти') : 'Вступить'}
                    </button>
                `;
                
                clanList.appendChild(clanElement);
            });
            
            // Добавляем обработчики событий для кнопок вступления в клан
            document.querySelectorAll('.join-button').forEach(button => {
                button.addEventListener('click', function() {
                    const clanId = parseInt(this.getAttribute('data-id'));
                    toggleClanMembership(clanId);
                });
            });
        }

        // Вступление/выход из клана
        function toggleClanMembership(clanId) {
            const clan = clans.find(c => c.id === clanId);
            if (!clan) return;
            
            const isMember = clan.members.includes(gameState.username);
            const isLeader = clan.leader === gameState.username;
            
            if (isMember) {
                // Выход из клана
                if (isLeader) {
                    // Лидер не может выйти из клана (должен распустить его)
                    showNotification('Ошибка', 'Вы лидер клана! Сначала передайте лидерство или распустите клан.', 'fa-exclamation-circle', 'danger');
                    return;
                }
                
                clan.members = clan.members.filter(m => m !== gameState.username);
                gameState.clan = null;
                showNotification('Клан', `Вы вышли из клана ${clan.name}`, 'fa-sign-out-alt', 'info');
            } else {
                // Вступление в клан
                // Сначала выходим из текущего клана, если есть
                if (gameState.clan) {
                    const currentClan = clans.find(c => c.id === gameState.clan.id);
                    if (currentClan) {
                        currentClan.members = currentClan.members.filter(m => m !== gameState.username);
                    }
                }
                
                clan.members.push(gameState.username);
                gameState.clan = { id: clan.id, name: clan.name, tag: clan.tag };
                showNotification('Клан', `Вы вступили в клан ${clan.name}`, 'fa-sign-in-alt', 'success');
            }
            
            // Обновляем UI
            renderClans();
            checkAchievements();
            saveGame();
        }

        // Показать уведомление
        function showNotification(title, message, icon, type) {
            const colors = {
                success: '#28a745',
                danger: '#dc3545',
                info: '#17a2b8',
                warning: '#ffc107'
            };
            
            notificationMessage.textContent = message;
            notification.querySelector('.notification-title').textContent = title;
            notification.querySelector('.notification-icon i').className = `fas ${icon}`;
            notification.style.background = `linear-gradient(135deg, ${colors[type] || '#6a5acd'}, ${colors[type] || '#483d8b'})`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Рендер таблицы лидеров
        function renderLeaderboard() {
            // Сортируем игроков по очкам
            const sortedPlayers = [...players].sort((a, b) => b.points - a.points);
            
            leaderboardBody.innerHTML = '';
            
            sortedPlayers.forEach((player, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="leaderboard-position">${index + 1}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="leaderboard-avatar" style="background-color: ${player.avatarColor}">${player.username.charAt(0).toUpperCase()}</div>
                            ${player.username}
                        </div>
                    </td>
                    <td>${player.points.toLocaleString()}</td>
                    <td>${player.rank}</td>
                `;
                
                // Подсветка текущего игрока
                if (player.username === gameState.username) {
                    row.style.backgroundColor = 'rgba(106, 90, 205, 0.1)';
                    row.style.fontWeight = 'bold';
                }
                
                leaderboardBody.appendChild(row);
            });
        }

        // Рендер титулов
        function renderTitles() {
            titleSelect.innerHTML = '';
            
            titles.forEach(title => {
                const unlocked = title.requirement();
                const option = document.createElement('option');
                option.value = title.id;
                option.textContent = title.name;
                option.disabled = !unlocked;
                if (gameState.title === title.name) {
                    option.selected = true;
                }
                titleSelect.appendChild(option);
            });
        }

        // Обновление информации о престиже
        function updatePrestigeInfo() {
            prestigeLevel.textContent = gameState.prestigeLevel;
            prestigeBonus.textContent = `+${Math.round((gameState.prestigeBonus - 1) * 100)}%`;
        }

        // Обновление кнопки престижа
        function updatePrestigeButton() {
            const requiredPoints = 25000 * Math.pow(2, gameState.prestigeLevel);
            prestigeRequirements.textContent = `Для престижа нужно ${requiredPoints.toLocaleString()} очков`;
            
            if (gameState.points >= requiredPoints) {
                prestigeButton.disabled = false;
                prestigeButton.innerHTML = `<i class="fas fa-star"></i> Престиж (${gameState.prestigeLevel + 1})`;
            } else {
                prestigeButton.disabled = true;
            }
        }

        // Выполнить престиж
        function performPrestige() {
            const requiredPoints = 25000 * Math.pow(2, gameState.prestigeLevel);
            
            if (gameState.points >= requiredPoints) {
                // Увеличиваем уровень престижа
                gameState.prestigeLevel++;
                
                // Увеличиваем бонус престижа (10% за уровень)
                gameState.prestigeBonus = 1 + gameState.prestigeLevel * 0.1;
                
                // Сбрасываем прогресс (но сохраняем престиж и некоторые улучшения)
                gameState.points = 0;
                gameState.pointsPerClick = 1;
                gameState.pointsPerSecond = 0;
                gameState.totalClicks = 0;
                gameState.upgradesBought = 0;
                gameState.playTime = 0;
                gameState.sessionStart = Date.now();
                
                // Сбрасываем улучшения (но оставляем престижные)
                upgrades.forEach(upgrade => {
                    upgrade.owned = 0;
                });
                
                // Обновляем UI
                updateUI();
                renderUpgrades();
                checkAchievements();
                
                // Показываем уведомление
                showNotification('Престиж', `Вы достигли ${gameState.prestigeLevel} уровня престижа!`, 'fa-star', 'warning');
                
                // Эффект конфетти
                createConfetti(50);
                
                // Сохраняем игру
                saveGame();
            }
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            // Клик по основной кнопке
            clickButton.addEventListener('click', () => {
                const now = Date.now();
                
                // Защита от автоматических кликов
                if (now - gameState.lastClickTime < 50) return; // Не более 20 кликов в секунду
                
                gameState.points += gameState.pointsPerClick * gameState.prestigeBonus;
                gameState.totalClicks++;
                gameState.lastClickTime = now;
                
                // Обновляем счетчик кликов в секунду
                if (now - gameState.lastClickTime < 1000) {
                    gameState.clicksInSecond++;
                } else {
                    gameState.clicksInSecond = 1;
                }
                
                updatePoints();
                updateStats();
                checkAchievements();
                
                // Анимация клика
                clickButton.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    clickButton.style.transform = 'scale(1)';
                }, 100);
                
                // Создаем эффект частиц
                createParticles(clickButton, 3, 'fa-hand-pointer');
            });
            
            // Редактирование профиля
            editProfileBtn.addEventListener('click', () => {
                usernameInput.value = gameState.username;
                avatarColor.value = gameState.avatarColor;
                renderTitles();
                profileModal.style.display = 'flex';
            });
            
            // Сохранение профиля
            saveProfileBtn.addEventListener('click', () => {
                const newUsername = usernameInput.value.trim() || 'Гость';
                const newTitle = titleSelect.options[titleSelect.selectedIndex].text;
                const newColor = avatarColor.value;
                
                // Обновляем имя игрока во всех местах, если оно изменилось
                if (gameState.username !== newUsername) {
                    // Обновляем в кланах
                    clans.forEach(clan => {
                        const memberIndex = clan.members.indexOf(gameState.username);
                        if (memberIndex !== -1) {
                            clan.members[memberIndex] = newUsername;
                        }
                        if (clan.leader === gameState.username) {
                            clan.leader = newUsername;
                        }
                    });
                    
                    // Обновляем в таблице лидеров
                    const playerIndex = players.findIndex(p => p.username === gameState.username);
                    if (playerIndex !== -1) {
                        players[playerIndex].username = newUsername;
                        renderLeaderboard();
                    }
                    
                    gameState.username = newUsername;
                }
                
                gameState.title = newTitle;
                gameState.avatarColor = newColor;
                
                updatePlayerInfo();
                renderClans();
                profileModal.style.display = 'none';
                saveGame();
            });
            
            // Отмена редактирования профиля
            cancelProfileBtn.addEventListener('click', () => {
                profileModal.style.display = 'none';
            });
            
            // Создание клана
            createClanBtn.addEventListener('click', () => {
                // Проверяем, не состоит ли игрок уже в клане
                if (gameState.clan) {
                    showNotification('Ошибка', 'Вы уже состоите в клане! Пожалуйста, выйдите из текущего клана перед созданием нового.', 'fa-exclamation-circle', 'danger');
                    return;
                }
                
                clanNameInput.value = '';
                clanTagInput.value = '';
                clanModal.style.display = 'flex';
            });
            
            // Подтверждение создания клана
            createClanConfirmBtn.addEventListener('click', () => {
                const clanName = clanNameInput.value.trim();
                const clanTag = clanTagInput.value.trim().toUpperCase();
                
                if (!clanName || clanName.length < 3) {
                    showNotification('Ошибка', 'Название клана должно содержать не менее 3 символов', 'fa-exclamation-circle', 'danger');
                    return;
                }
                
                if (!clanTag || clanTag.length < 2 || clanTag.length > 4) {
                    showNotification('Ошибка', 'Тег клана должен содержать от 2 до 4 символов', 'fa-exclamation-circle', 'danger');
                    return;
                }
                
                // Проверяем, нет ли уже клана с таким тегом
                if (clans.some(c => c.tag === clanTag)) {
                    showNotification('Ошибка', 'Клан с таким тегом уже существует!', 'fa-exclamation-circle', 'danger');
                    return;
                }
                
                // Создаем новый клан
                const newClan = {
                    id: clans.length > 0 ? Math.max(...clans.map(c => c.id)) + 1 : 1,
                    name: clanName,
                    tag: clanTag,
                    members: [gameState.username],
                    leader: gameState.username,
                    points: Math.floor(gameState.points)
                };
                
                clans.push(newClan);
                gameState.clan = { id: newClan.id, name: newClan.name, tag: newClan.tag };
                
                // Добавляем игрока в таблицу лидеров, если его там нет
                if (!players.some(p => p.username === gameState.username)) {
                    players.push({
                        username: gameState.username,
                        points: Math.floor(gameState.points),
                        rank: gameState.rank,
                        avatarColor: gameState.avatarColor
                    });
                }
                
                // Обновляем UI
                renderClans();
                renderLeaderboard();
                checkAchievements();
                clanModal.style.display = 'none';
                saveGame();
                
                showNotification('Клан', `Вы создали клан ${clanName} [${clanTag}]`, 'fa-users', 'success');
            });
            
            // Отмена создания клана
            cancelClanBtn.addEventListener('click', () => {
                clanModal.style.display = 'none';
            });
            
            // Переключение вкладок
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Убираем активный класс у всех вкладок и контента
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Добавляем активный класс текущей вкладке и контенту
                    tab.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Кнопка престижа
            prestigeButton.addEventListener('click', performPrestige);
            
            // Сохранение при закрытии вкладки
            window.addEventListener('beforeunload', saveGame);
            
            // Защита от двойного нажатия
            document.addEventListener('dblclick', (e) => {
                e.preventDefault();
            }, { passive: false });
            
            // Защита от открытия контекстного меню
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });
        }

        // Запуск игры
        initGame();
    </script>
</body>
</html>
