<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timed-Mail.com - Анонимная временная почта</title>
    <style>
        :root {
            --primary: #4285f4;
            --danger: #ea4335;
            --background: #f5f5f5;
            --card-bg: #ffffff;
            --text: #333333;
            --text-light: #666666;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--background);
            color: var(--text);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: var(--primary);
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mailbox-card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .email-list {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .email-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
        }
        
        .email-item:hover {
            background: #f9f9f9;
        }
        
        .email-item.unread {
            font-weight: bold;
        }
        
        .email-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #3367d6;
        }
        
        button.danger {
            background: var(--danger);
        }
        
        button.danger:hover {
            background: #c23321;
        }
        
        .timer {
            color: var(--text-light);
            font-size: 14px;
            margin-top: 5px;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 12px;
            background: #e0e0e0;
            color: var(--text);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            border-bottom: 2px solid var(--primary);
            font-weight: bold;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: var(--text-light);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div>
                <h1>Timed-Mail.com</h1>
                <p>Анонимная временная почта</p>
            </div>
            <div id="currentMailboxInfo" style="display: none;">
                <div style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 4px;">
                    <strong id="currentMailbox"></strong>
                    <div class="timer">Удаление через: <span id="expiryTimer">24:00:00</span></div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="createMailboxSection" class="mailbox-card">
            <h2>Создать новый почтовый ящик</h2>
            <button id="createMailboxBtn">Создать @timed-mail.com</button>
        </div>

        <div id="mailboxSection" class="mailbox-card" style="display: none;">
            <div class="tabs">
                <div class="tab active" data-tab="inbox">Входящие</div>
                <div class="tab" data-tab="compose">Написать</div>
                <div class="tab" data-tab="settings">Настройки</div>
            </div>
            
            <div id="inboxTab" class="tab-content active">
                <div class="email-list" id="inbox">
                    <div class="empty-state">Почтовый ящик пуст</div>
                </div>
            </div>
            
            <div id="composeTab" class="tab-content">
                <form id="sendEmailForm">
                    <div>
                        <label>От:</label>
                        <input type="email" id="fromEmail" readonly>
                    </div>
                    <div>
                        <label>Кому:</label>
                        <input type="email" id="toEmail" required>
                    </div>
                    <div>
                        <label>Тема:</label>
                        <input type="text" id="emailSubject">
                    </div>
                    <div>
                        <label>Сообщение:</label>
                        <textarea id="emailBody"></textarea>
                    </div>
                    <button type="submit">Отправить письмо</button>
                </form>
            </div>
            
            <div id="settingsTab" class="tab-content">
                <h3>Настройки почтового ящика</h3>
                <div style="margin-bottom: 15px;">
                    <label>Срок действия:</label>
                    <select id="expirySelect">
                        <option value="1">1 час</option>
                        <option value="6">6 часов</option>
                        <option value="24" selected>24 часа</option>
                        <option value="72">3 дня</option>
                        <option value="168">7 дней</option>
                    </select>
                </div>
                <button id="deleteMailboxBtn" class="danger">Удалить почтовый ящик</button>
            </div>
        </div>
    </div>

    <script>
        // Хранилище данных
        let mailboxes = JSON.parse(localStorage.getItem('timedMailboxes')) || {};
        let currentMailbox = localStorage.getItem('currentMailbox');
        
        // DOM элементы
        const createMailboxBtn = document.getElementById('createMailboxBtn');
        const createMailboxSection = document.getElementById('createMailboxSection');
        const mailboxSection = document.getElementById('mailboxSection');
        const currentMailboxInfo = document.getElementById('currentMailboxInfo');
        const currentMailboxDisplay = document.getElementById('currentMailbox');
        const expiryTimer = document.getElementById('expiryTimer');
        const inbox = document.getElementById('inbox');
        const fromEmail = document.getElementById('fromEmail');
        const toEmail = document.getElementById('toEmail');
        const emailSubject = document.getElementById('emailSubject');
        const emailBody = document.getElementById('emailBody');
        const sendEmailForm = document.getElementById('sendEmailForm');
        const expirySelect = document.getElementById('expirySelect');
        const deleteMailboxBtn = document.getElementById('deleteMailboxBtn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            if (currentMailbox && mailboxes[currentMailbox]) {
                showMailbox(currentMailbox);
            }
            
            // Обновляем таймер каждую секунду
            setInterval(updateTimers, 1000);
            
            // Проверяем почту каждые 30 секунд
            setInterval(checkInbox, 30000);
        });
        
        // Создание почтового ящика
        createMailboxBtn.addEventListener('click', () => {
            const id = generateId();
            const address = `${id}@timed-mail.com`;
            const expiresAt = Date.now() + 24 * 60 * 60 * 1000; // 24 часа по умолчанию
            
            mailboxes[address] = {
                id,
                address,
                createdAt: Date.now(),
                expiresAt,
                emails: [],
                expiryHours: 24
            };
            
            saveMailboxes();
            showMailbox(address);
        });
        
        // Отправка письма
        sendEmailForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const from = fromEmail.value;
            const to = toEmail.value;
            const subject = emailSubject.value;
            const text = emailBody.value;
            
            try {
                // Используем Mailtrap API для тестовой отправки
                const response = await fetch('https://send.api.mailtrap.io/api/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_MAILTRAP_API_KEY'
                    },
                    body: JSON.stringify({
                        from: { email: from },
                        to: [{ email: to }],
                        subject,
                        text
                    })
                });
                
                if (!response.ok) throw new Error('Ошибка отправки');
                
                alert('Письмо отправлено!');
                emailSubject.value = '';
                emailBody.value = '';
            } catch (error) {
                alert('Ошибка при отправке: ' + error.message);
            }
        });
        
        // Удаление почтового ящика
        deleteMailboxBtn.addEventListener('click', () => {
            if (confirm('Вы уверены, что хотите удалить этот почтовый ящик? Все письма будут потеряны.')) {
                delete mailboxes[currentMailbox];
                saveMailboxes();
                currentMailbox = null;
                localStorage.removeItem('currentMailbox');
                
                createMailboxSection.style.display = 'block';
                mailboxSection.style.display = 'none';
                currentMailboxInfo.style.display = 'none';
            }
        });
        
        // Изменение срока действия
        expirySelect.addEventListener('change', () => {
            if (!currentMailbox) return;
            
            const hours = parseInt(expirySelect.value);
            mailboxes[currentMailbox].expiresAt = Date.now() + hours * 60 * 60 * 1000;
            mailboxes[currentMailbox].expiryHours = hours;
            saveMailboxes();
        });
        
        // Переключение вкладок
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');
            });
        });
        
        // Функции
        function showMailbox(address) {
            currentMailbox = address;
            localStorage.setItem('currentMailbox', address);
            
            createMailboxSection.style.display = 'none';
            mailboxSection.style.display = 'block';
            currentMailboxInfo.style.display = 'block';
            
            currentMailboxDisplay.textContent = address;
            fromEmail.value = address;
            
            // Установка выбранного срока действия
            expirySelect.value = mailboxes[address].expiryHours;
            
            // Показываем письма
            renderInbox();
        }
        
        function renderInbox() {
            if (!currentMailbox || !mailboxes[currentMailbox]) return;
            
            const mailbox = mailboxes[currentMailbox];
            
            if (mailbox.emails.length === 0) {
                inbox.innerHTML = '<div class="empty-state">Почтовый ящик пуст</div>';
                return;
            }
            
            inbox.innerHTML = '';
            mailbox.emails.forEach(email => {
                const emailEl = document.createElement('div');
                emailEl.className = `email-item ${email.read ? '' : 'unread'}`;
                emailEl.innerHTML = `
                    <div>
                        <strong>${email.from}</strong>
                        <div>${email.subject || '(без темы)'}</div>
                    </div>
                    <div>
                        <small>${formatDate(email.receivedAt)}</small>
                    </div>
                `;
                
                emailEl.addEventListener('click', () => {
                    // Помечаем как прочитанное
                    if (!email.read) {
                        email.read = true;
                        saveMailboxes();
                        emailEl.classList.remove('unread');
                    }
                    
                    // Показываем содержимое письма
                    alert(`От: ${email.from}\nТема: ${email.subject}\nДата: ${formatDate(email.receivedAt)}\n\n${email.text}`);
                });
                
                inbox.appendChild(emailEl);
            });
        }
        
        function checkInbox() {
            // В реальной реализации здесь бы был запрос к серверу
            // Для демонстрации просто обновляем интерфейс
            if (currentMailbox) {
                renderInbox();
                updateTimers();
            }
        }
        
        function updateTimers() {
            if (!currentMailbox || !mailboxes[currentMailbox]) return;
            
            const mailbox = mailboxes[currentMailbox];
            const now = Date.now();
            const distance = mailbox.expiresAt - now;
            
            if (distance < 0) {
                expiryTimer.textContent = '00:00:00';
                delete mailboxes[currentMailbox];
                saveMailboxes();
                
                createMailboxSection.style.display = 'block';
                mailboxSection.style.display = 'none';
                currentMailboxInfo.style.display = 'none';
                
                return;
            }
            
            const hours = Math.floor(distance / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            expiryTimer.textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function saveMailboxes() {
            localStorage.setItem('timedMailboxes', JSON.stringify(mailboxes));
        }
        
        function generateId() {
            return Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 6);
        }
        
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString();
        }
    </script>
</body>
</html>
