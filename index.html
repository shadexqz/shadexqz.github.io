<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Домашний майнер</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 100%;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            margin: 0;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .currency-selector {
            font-size: 16px;
            padding: 5px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        .mining-section {
            text-align: center;
            margin: 30px 0;
        }
        .propeller {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            position: relative;
        }
        .propeller-blade {
            position: absolute;
            width: 40px;
            height: 10px;
            background-color: #5b8bf7;
            border-radius: 5px;
            top: 45px;
            left: 30px;
            transform-origin: left center;
        }
        .balance {
            font-size: 28px;
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
        }
        .button {
            background-color: #5b8bf7;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            transition: background-color 0.3s;
        }
        .button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .button:hover:not(:disabled) {
            background-color: #3a6fd6;
        }
        .button.secondary {
            background-color: #6c757d;
        }
        .button.secondary:hover {
            background-color: #5a6268;
        }
        .status {
            font-size: 14px;
            color: #666;
            margin-top: 20px;
            text-align: center;
        }
        .divider {
            height: 1px;
            background-color: #eee;
            margin: 20px 0;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            border-bottom: 3px solid #5b8bf7;
            font-weight: bold;
        }
        .withdraw-message {
            text-align: center;
            padding: 30px;
            background-color: #f8f9fa;
            border-radius: 12px;
            margin: 20px 0;
        }
        .withdraw-icon {
            font-size: 50px;
            color: rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        .upgrade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .upgrade-item:last-child {
            border-bottom: none;
        }
        .upgrade-info {
            flex: 1;
        }
        .upgrade-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .upgrade-description {
            font-size: 12px;
            color: #666;
        }
        .upgrade-price {
            font-weight: bold;
            color: #28a745;
            margin-left: 15px;
        }
        .user-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .user-info {
            flex: 1;
        }
        .user-name {
            font-weight: bold;
        }
        .user-balance {
            color: #28a745;
            font-weight: bold;
        }
        .support-link {
            color: #5b8bf7;
            text-decoration: none;
            display: block;
            margin-top: 10px;
            text-align: center;
        }
        .settings-item {
            margin-bottom: 15px;
        }
        .settings-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="tabs">
        <div class="tab active" onclick="switchTab('mining')">Майнинг</div>
        <div class="tab" onclick="switchTab('top')">Топ</div>
        <div class="tab" onclick="switchTab('upgrades')">Улучшения</div>
        <div class="tab" onclick="switchTab('settings')">Настройки</div>
    </div>

    <div id="mining-tab" class="tab-content active">
        <div class="container">
            <div class="header">
                <span>Домашний майнер</span>
                <select class="currency-selector" id="currencySelector">
                    <option value="RUB">RUB</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                </select>
            </div>
            
            <div class="balance" id="balance">0 RUB</div>
            
            <div class="mining-section">
                <div class="propeller" id="propeller">
                    <div class="propeller-blade" style="transform: rotate(0deg);"></div>
                    <div class="propeller-blade" style="transform: rotate(90deg);"></div>
                    <div class="propeller-blade" style="transform: rotate(180deg);"></div>
                    <div class="propeller-blade" style="transform: rotate(270deg);"></div>
                </div>
                <div id="status">Нажмите "Майнить" чтобы начать</div>
            </div>
            
            <button class="button" id="mineButton">Майнить</button>
            <div class="divider"></div>
            <button class="button" id="withdrawButton">Вывод</button>
        </div>
    </div>

    <div id="top-tab" class="tab-content">
        <div class="container">
            <div class="header">Топ майнеров</div>
            
            <div id="topList">
                <!-- Топ будет заполняться динамически -->
                <div class="user-item">
                    <div class="user-avatar">
                        <img src="https://via.placeholder.com/40" alt="User">
                    </div>
                    <div class="user-info">
                        <div class="user-name">Иван Иванов</div>
                    </div>
                    <div class="user-balance">1,245 RUB</div>
                </div>
                <!-- Другие пользователи -->
            </div>
        </div>
    </div>

    <div id="upgrades-tab" class="tab-content">
        <div class="container">
            <div class="header">Улучшения</div>
            
            <div id="upgradesList">
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-title">Базовый процессор</div>
                        <div class="upgrade-description">+0.01 к майнингу в секунду</div>
                    </div>
                    <div class="upgrade-price">50 RUB</div>
                </div>
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-title">Улучшенный кулер</div>
                        <div class="upgrade-description">+5% к скорости майнинга</div>
                    </div>
                    <div class="upgrade-price">100 RUB</div>
                </div>
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-title">Видеокарта</div>
                        <div class="upgrade-description">+0.03 к майнингу в секунду</div>
                    </div>
                    <div class="upgrade-price">200 RUB</div>
                </div>
            </div>
        </div>
    </div>

    <div id="settings-tab" class="tab-content">
        <div class="container">
            <div class="header">Настройки</div>
            
            <div class="settings-item">
                <label class="settings-label">Валюта</label>
                <select class="currency-selector" id="settingsCurrencySelector">
                    <option value="RUB">RUB</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                </select>
            </div>
            
            <button class="button secondary" id="supportButton">Поддержка</button>
            
            <a href="https://t.me/HomeMining_support" class="support-link" target="_blank">
                t.me/HomeMining_support
            </a>
        </div>
    </div>

    <div id="withdraw-modal" style="display: none;">
        <div class="container">
            <div class="withdraw-message">
                <div class="withdraw-icon">
                    <i class="far fa-frown"></i>
                </div>
                <h3>На данный момент мы не реализовали данную систему</h3>
                <p>Но всё еще впереди!</p>
            </div>
            <button class="button" onclick="hideWithdrawModal()">Понятно</button>
        </div>
    </div>

    <script>
        // Состояние приложения
        const state = {
            balance: 0,
            isMining: false,
            miningInterval: null,
            rotationAngle: 0,
            miningSpeed: 1,
            sessionStartTime: 0,
            currency: 'RUB',
            exchangeRates: {
                RUB: 1,
                USD: 0.011,
                EUR: 0.010
            },
            upgrades: [
                { id: 1, name: "Базовый процессор", price: 50, effect: 0.01, purchased: false },
                { id: 2, name: "Улучшенный кулер", price: 100, effect: 0.05, purchased: false },
                { id: 3, name: "Видеокарта", price: 200, effect: 0.03, purchased: false }
            ],
            topUsers: [
                { id: 1, name: "Иван Иванов", balance: 1245, avatar: "https://via.placeholder.com/40" },
                { id: 2, name: "Анна Петрова", balance: 980, avatar: "https://via.placeholder.com/40" },
                { id: 3, name: "Сергей Сидоров", balance: 750, avatar: "https://via.placeholder.com/40" },
                { id: 4, name: "Елена Васильева", balance: 620, avatar: "https://via.placeholder.com/40" },
                { id: 5, name: "Дмитрий Николаев", balance: 540, avatar: "https://via.placeholder.com/40" }
            ]
        };

        // Элементы DOM
        const elements = {
            balance: document.getElementById('balance'),
            mineButton: document.getElementById('mineButton'),
            withdrawButton: document.getElementById('withdrawButton'),
            status: document.getElementById('status'),
            propeller: document.getElementById('propeller'),
            blades: document.querySelectorAll('.propeller-blade'),
            currencySelector: document.getElementById('currencySelector'),
            settingsCurrencySelector: document.getElementById('settingsCurrencySelector'),
            topList: document.getElementById('topList'),
            upgradesList: document.getElementById('upgradesList'),
            withdrawModal: document.getElementById('withdraw-modal'),
            supportButton: document.getElementById('supportButton')
        };

        // Инициализация приложения
        function initApp() {
            // Загружаем данные из localStorage
            loadData();
            
            // Обновляем интерфейс
            updateBalance();
            renderTopList();
            renderUpgrades();
            
            // Настройки Telegram WebApp
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            
            // Добавляем текущего пользователя в топ
            if (Telegram.WebApp.initDataUnsafe.user) {
                const user = Telegram.WebApp.initDataUnsafe.user;
                state.topUsers.unshift({
                    id: user.id,
                    name: `${user.first_name || ''} ${user.last_name || ''}`.trim() || `User${user.id}`,
                    balance: Math.floor(state.balance),
                    avatar: user.photo_url || "https://via.placeholder.com/40"
                });
                renderTopList();
            }
        }

        // Загрузка данных
        function loadData() {
            const savedData = localStorage.getItem('homeMinerData');
            if (savedData) {
                const data = JSON.parse(savedData);
                state.balance = data.balance || 0;
                state.currency = data.currency || 'RUB';
                state.upgrades = data.upgrades || state.upgrades;
                state.miningSpeed = calculateMiningSpeed();
                
                elements.currencySelector.value = state.currency;
                elements.settingsCurrencySelector.value = state.currency;
            }
        }

        // Сохранение данных
        function saveData() {
            const data = {
                balance: state.balance,
                currency: state.currency,
                upgrades: state.upgrades
            };
            localStorage.setItem('homeMinerData', JSON.stringify(data));
        }

        // Расчет скорости майнинга
        function calculateMiningSpeed() {
            let speed = 1;
            state.upgrades.forEach(upgrade => {
                if (upgrade.purchased) {
                    speed += upgrade.effect;
                }
            });
            return speed;
        }

        // Обновление баланса
        function updateBalance() {
            const currencySymbol = {
                RUB: '₽',
                USD: '$',
                EUR: '€'
            };
            elements.balance.textContent = `${state.balance.toFixed(2)} ${currencySymbol[state.currency]}`;
        }

        // Анимация пропеллера
        function animatePropeller() {
            state.rotationAngle += 10 * state.miningSpeed;
            elements.blades.forEach((blade, index) => {
                blade.style.transform = `rotate(${state.rotationAngle + (index * 90)}deg)`;
            });
            
            if (state.isMining) {
                requestAnimationFrame(animatePropeller);
            }
        }

        // Майнинг
        function startMining() {
            if (state.isMining) return;
            
            state.isMining = true;
            state.sessionStartTime = Date.now();
            elements.mineButton.disabled = true;
            updateStatus(`Майнинг... Осталось: 10:00`);
            
            // Случайное количество майнинга (0.005-0.015 в секунду)
            const baseRate = 0.01 * state.exchangeRates[state.currency];
            const minRate = baseRate * 0.5;
            const maxRate = baseRate * 1.5;
            
            // Обновляем баланс каждую секунду
            state.miningInterval = setInterval(() => {
                // Случайное значение майнинга
                const randomMultiplier = 0.5 + Math.random();
                state.balance += (minRate + (maxRate - minRate) * Math.random()) * state.miningSpeed;
                updateBalance();
                
                // Обновляем таймер
                const elapsed = Math.floor((Date.now() - state.sessionStartTime) / 1000);
                const remaining = 600 - elapsed; // 10 минут = 600 секунд
                
                if (remaining <= 0) {
                    stopMining();
                    updateStatus('Сессия завершена');
                } else {
                    const minutes = Math.floor(remaining / 60);
                    const seconds = remaining % 60;
                    updateStatus(`Майнинг... Осталось: ${minutes}:${seconds.toString().padStart(2, '0')}`);
                }
            }, 1000);
            
            // Запускаем анимацию
            animatePropeller();
            saveData();
        }

        function stopMining() {
            state.isMining = false;
            clearInterval(state.miningInterval);
            elements.mineButton.disabled = false;
            saveData();
        }

        function updateStatus(text) {
            elements.status.textContent = text;
        }

        // Переключение вкладок
        function switchTab(tabName) {
            // Скрыть все вкладки
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Скрыть все табы
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Показать выбранную вкладку
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Активировать выбранный таб
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.textContent === getTabName(tabName)) {
                    tab.classList.add('active');
                }
            });
        }

        function getTabName(tabId) {
            const names = {
                mining: 'Майнинг',
                top: 'Топ',
                upgrades: 'Улучшения',
                settings: 'Настройки'
            };
            return names[tabId] || tabId;
        }

        // Показать модальное окно вывода
        function showWithdrawModal() {
            elements.withdrawModal.style.display = 'block';
        }

        function hideWithdrawModal() {
            elements.withdrawModal.style.display = 'none';
        }

        // Рендер списка топов
        function renderTopList() {
            elements.topList.innerHTML = '';
            
            // Сортируем пользователей по балансу
            const sortedUsers = [...state.topUsers].sort((a, b) => b.balance - a.balance);
            
            sortedUsers.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'user-item';
                
                userElement.innerHTML = `
                    <div class="user-avatar">
                        <img src="${user.avatar}" alt="${user.name}">
                    </div>
                    <div class="user-info">
                        <div class="user-name">${user.name}</div>
                    </div>
                    <div class="user-balance">${user.balance.toLocaleString()} ${state.currency}</div>
                `;
                
                elements.topList.appendChild(userElement);
            });
        }

        // Рендер улучшений
        function renderUpgrades() {
            elements.upgradesList.innerHTML = '';
            
            state.upgrades.forEach(upgrade => {
                const upgradeElement = document.createElement('div');
                upgradeElement.className = 'upgrade-item';
                
                if (upgrade.purchased) {
                    upgradeElement.innerHTML = `
                        <div class="upgrade-info">
                            <div class="upgrade-title">${upgrade.name} (куплено)</div>
                            <div class="upgrade-description">+${upgrade.effect * 100}% к скорости майнинга</div>
                        </div>
                        <div class="upgrade-price">✓</div>
                    `;
                } else {
                    upgradeElement.innerHTML = `
                        <div class="upgrade-info">
                            <div class="upgrade-title">${upgrade.name}</div>
                            <div class="upgrade-description">+${upgrade.effect * 100}% к скорости майнинга</div>
                        </div>
                        <div class="upgrade-price">${upgrade.price} ${state.currency}</div>
                    `;
                    
                    upgradeElement.addEventListener('click', () => purchaseUpgrade(upgrade.id));
                }
                
                elements.upgradesList.appendChild(upgradeElement);
            });
        }

        // Покупка улучшения
        function purchaseUpgrade(upgradeId) {
            const upgrade = state.upgrades.find(u => u.id === upgradeId);
            if (!upgrade || upgrade.purchased) return;
            
            if (state.balance >= upgrade.price) {
                state.balance -= upgrade.price;
                upgrade.purchased = true;
                state.miningSpeed = calculateMiningSpeed();
                
                updateBalance();
                renderUpgrades();
                saveData();
                
                updateStatus(`Улучшение "${upgrade.name}" приобретено!`);
            } else {
                updateStatus(`Недостаточно средств для "${upgrade.name}"`);
            }
        }

        // Смена валюты
        function changeCurrency(newCurrency) {
            if (state.currency === newCurrency) return;
            
            // Конвертируем баланс
            state.balance = (state.balance / state.exchangeRates[state.currency]) * state.exchangeRates[newCurrency];
            state.currency = newCurrency;
            
            // Обновляем интерфейс
            updateBalance();
            renderTopList();
            renderUpgrades();
            saveData();
        }

        // Обработчики событий
        elements.mineButton.addEventListener('click', startMining);
        elements.withdrawButton.addEventListener('click', showWithdrawModal);
        elements.supportButton.addEventListener('click', () => {
            window.open('https://t.me/HomeMining_support', '_blank');
        });

        elements.currencySelector.addEventListener('change', (e) => {
            changeCurrency(e.target.value);
        });

        elements.settingsCurrencySelector.addEventListener('change', (e) => {
            changeCurrency(e.target.value);
            elements.currencySelector.value = e.target.value;
        });

        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
